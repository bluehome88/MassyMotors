<html>
<head>
<title>Job Applications Report</title>
<link rel="stylesheet" type="text/css" href="<?= BASEURL; ?>libs/Metro-UI/css/modern.css" />
<link rel="stylesheet" type="text/css" href="<?= BASEURL; ?>libs/Metro-UI/css/modern-responsive.css" />
<link rel="stylesheet" type="text/css" href="<?= BASEURL; ?>app/Mas/customer-report.css" />

<style>
.filter_sec {
	padding:10px;
	background-color:#EEE;
	border:1px solid #EEE;
}
dt,dd {
	display:inline;
	margin:0px;
}
dt:after {
	content:': ';
}
dt {
	font-weight:bold;
}
dd {
	margin-right:20px;
}
th {
	font-weight:bold !important;
}
</style>

</head>
<body>
<h1>Job Applications Report</h1>
<dl>
	<dt>Generated</dt>
	<dd><?= date("r"); ?></dd>
	
	<dt>Generated by</dt>
	<dd><?= Jax_Auth::getAuthId(); ?></dd>
</dl>

<div class="filter_sec">
<h3>Filters Applied</h3>
<dl>
	<?php 
		if(is_array($this->params)){
			foreach ($this->params as $filter=>$value){
				if(substr($filter,0,4)=='frm_' && strlen($value) > 0){
					echo "<dt>".ucwords(str_replace("_"," ",substr($filter,4)))."</dt><dd>$value</dd>";
				}
			}
		} else {
			echo "No filters applied";
		}
	?>
</dl>
</div>
<h3>Records: <?= count($this->data); ?></h3>

<table>
<thead>
<tr>
<?php 
$data = $this->data;

$header = false;
$colspan = 0;

foreach($data as $row){
	$head = "";
	$rd = "<tr>";
	$recordId = 0;
	foreach ($row as $h=>$v){

		if ($h=="id"){
			$recordId = $v;
			continue;
		}

		if(strtolower($h) == "email"){
			$v = "<a href=\"mailto:$v\">$v</a>";
		}
		
		if(strtolower($h) == "cv"){
			if(empty($v)){
				$v = "<small>[not provided]</small>";
			} else {
				$v = "<a href=\"http://massystorestt.com/data-portal/public/Hilo/Jobapp/cv/cid/$recordId\" target=\"_blank\">view CV</a>";
			}
		}

		if(!$header){
			$h = ucwords(str_replace("_"," ", $h));
			$head .= "<th>$h</th>";
			$rd .= "<td>$v</td>";
			
			$colspan++;
		} else {
			$rd .= "<td>$v</td>";
		}
	}
	
	if(!$header){
		echo "$head</tr></thead><tbody>";
		$header = true;
	}
	
	echo $rd."</tr>";
}
?>
</tbody>
</table>
</body>
</html>